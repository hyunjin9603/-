<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>코린이들의 단어장</title>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
            crossorigin="anonymous"></script>

            <script src="http://code.jquery.com/jquery-latest.js"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0" />
    <!-- font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Do+Hyeon&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Jua&display=swap" rel="stylesheet">

        <!-- Bulma CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.1/css/bulma.min.css">
    <!-- Font Awesome CSS -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='/static/mystyle.css') }}" rel="stylesheet">

    <!-- JS -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.js"></script>

    <style>
        *{margin: 0; padding: 0; font-family: 'Jua', sans-serif; border: none; text-decoration: none; list-style: none; color: #222;scroll-behavior: smooth;}

        body{background: rgba(0, 48, 15, 0.1);}

        header{display: flex; justify-content: space-around; overflow: hidden; height: 90px; border-bottom: 5px solid rgb(0, 48, 15);}

        header .logo{width: 180px; height: 50px; margin-top: 20px; box-sizing: border-box; transition: .4s; border: 2px solid darkslategrey; border-radius: 30px; background: white;}
        header .logo a{display: block; height: 100%; line-height: 48px; font-size: 20px; text-align: center}
        header .logo:hover{background: rgba(0, 48, 15, 0.76); color: white}
        header .logo:hover a{color: white}

        header .gnb_wrap{width: 270px;}
        header .gnb_wrap .gnb{overflow: hidden; height: 50px; margin-top: 20px;}
        header .gnb_wrap .gnb li{float: left; width: 33.333%; border-right: 4px solid darkslategrey; border-radius: 10px; box-sizing: border-box}
        header .gnb_wrap .gnb li:last-child{border: none}
        header .gnb_wrap .gnb li a{display: block; width: 100%; text-align: center;}
        header .gnb_wrap .gnb li a img{}

        header button#login_bt{width: 150px; height: 50px; margin-top: 20px; transition: .4s; border: 2px solid darkslategrey; border-radius: 30px; background: white;}
        header button#login_bt a{display: block; height: 100%; line-height: 45px; font-size: 18px}
        header button#login_bt:hover{background: rgba(0, 48, 15, 0.76); color: white}
        header button#login_bt:hover a{color: white}

        section{}

        section .save_search_box{width: 50%; height: 600px; margin: 100px auto; border: 15px double rgba(0, 48, 15, 0.76); border-left: none; border-right: none; border-radius: 10px; background: rgba(0, 102, 60, 0.04) }

        section .save_search_box .save{overflow: hidden; box-sizing: border-box; width:60%; margin: 50px auto; padding-bottom: 20px; border: 2px solid darkgreen; border-left: none; border-right: none; border-radius: 20px; }
        section .save_search_box .save span{display: block; height: 70px; font-size: 20px; text-align: center; line-height: 70px}
        section .save_search_box .save div.sign{width: 40%; height: 50px; margin: 20px auto; border: 2px solid darkolivegreen; border-radius: 20px; background: white}
        section .save_search_box .save div#term_box{margin-top: 0}
        section .save_search_box .save div input{display: block; width: 95%; padding: 2px 20px; line-height: 50px; font-size: 18px; background: none; outline: none; color: #444}
        section .save_search_box .save  input#word{}
        section .save_search_box .save  input#meaning{}

        section .save_search_box .save .save_bt{display: flex; justify-content: center;}
        section .save_search_box .save .save_bt button#save_bt{width: 120px; height: 35px; transition: .4s; line-height: 30px; cursor: pointer;  font-size: 18px; border-radius: 20px; background: rgba(0, 48, 15, 0.76); color: #F6F6F6}
        section .save_search_box .save .save_bt button#save_bt:hover{border: 2px solid darkslategrey; background: white; color: #333}

        section .save_search_box .search{overflow: hidden; width: 50%; margin: 30px auto 0 auto; border: 2px solid darkgreen; border-left: none; border-right: none; border-radius: 20px;}
        section .save_search_box .search input#search{display:block; width: 60%; height: 40px; margin: 40px auto 20px auto; padding: 0 5px; border: 2px solid darkolivegreen; border-radius: 20px; padding: 2px 20px; font-size: 18px; color: #555; outline: none}
        section .save_search_box .search button#search_bt{display:block; width: 120px; height: 35px; margin: 0 auto 20px auto; transition: .4s; line-height: 30px; cursor: pointer; font-size: 18px;  border-radius: 20px; background: rgba(0, 48, 15, 0.76); color: #F6F6F6}
        section .save_search_box .search button#search_bt:hover{border: 2px solid darkslategrey; background: white; color: #333}

        section .save_in table{width: 60%; margin: 0 auto; background: rgba(0, 48, 15, 0.76); border-top: 35px solid #4B2718; border-radius: 10px 10px 0 0;}
        section .save_in table thead{width: 100%; padding: 50px; border-spacing: 30px;}
        section .save_in table tr{}
        section .save_in table tr th{font-size: 30px; font-family: 'Do Hyeon', sans-serif; font-weight: lighter; border-bottom: 2px dashed #F6F6F6; border-spacing: 0px; color: #F6F6F6;}
        section .save_in table tr th:nth-child(1){width: 400px;}
        section .save_in table tr td{padding: 20px 40px; border-bottom: 1px solid white; font-size: 19px; color: #F6F6F6}
        section .save_in table tr td.mark{transition: .4s; width: 48px; padding: 0; cursor: pointer; background: url("/static/bookmark_FILL0_wght400_GRAD0_opsz48.png") no-repeat; border-bottom: none}
        section .save_in table tr td.mark:hover{background: url("/static/bookmark_FILL1_wght400_GRAD0_opsz48.png") no-repeat;}
    </style>
    <script>
        $(document).ready(function () {
            get_posts();
        });

        function toggle_like(word_id) {
            console.log(word_id)
            let $a_like = $(`#${word_id} a[aria-label='bookmark']`)
            let $i_like = $a_like.find("i")
            if ($i_like.hasClass("fa-bookmark")) {
                $.ajax({
                    type: "POST",
                    url: "/update_bookmark",
                    data: {
                        word_id_give: word_id,
                        action_give: "unlike"
                    },
                    success: function (response) {
                        console.log("unlike")
                        $i_like.addClass("fa-bookmark-o").removeClass("fa-bookmark")
                    }
                })
            } else {
                $.ajax({
                    type: "POST",
                    url: "/update_bookmark",
                    data: {
                        word_id_give: word_id,
                        action_give: "like"
                    },
                    success: function (response) {
                        console.log("like")
                        $i_like.addClass("fa-bookmark").removeClass("fa-bookmark-o")
                    }
                })
            }
        }

        function post() {
            let word = $("#word").val()
            let meaning = $("#meaning").val()
            $.ajax({
                type: "POST",
                url: "/words",
                data: {
                    word_give: word,
                    meaning_give: meaning
                },
                success: function (response) {
                    window.location.reload()
                }
            })
        }

        function get_posts() {
            $('#tbody-box').empty()
            $.ajax({
                type: 'GET',
                url: '/words',
                data: {},
                success: function (response) {
                    console.log(word['word'])
                    if (response["result"] === "success") {
                        let words = response["words"]
                        for (let i = 0; i < words.length; i++) {
                            let word = words[i]
                            console.log(word['word'])
                            // 삼항 연산자
                            let class_bookmark = word['bookmark_by_me'] ? "fa-bookmark" : "fa-bookmark-o"
                            let html_temp = `<tr id="${word['_id']}">
                                                <td><a href="#">${word['word']}</a></td>
                                                <td>${word['meaning']}</td>
                                                <td><a class="level-item is-sparta" aria-label="bookmark" onclick="toggle_like('${word['_id']}', 'bookmark')">
                                                <span class="icon is-small"><i class="fa ${class_bookmark}" aria-hidden="true"></i></span></a></td>
                                                <td><button type="button" onclick="delete_word()">X</button></td>

                                            </tr>`

                            $('#tbody-box').append(html_temp)
                        }
                    }
                }
            })
        }




        function bookmark() {
            $("#tbody-box").empty()
            $.ajax({
                type: "GET",
                url: "/words",
                data: {},
                success: function (response) {
                    console.log(response)
                    if (response["result"] === "success") {
                        let words = response["words"]
                        for (let i = 0; i < words.length; i++) {
                            let word = words[i]
                            let num = words[i]['num']
                            // 삼항 연산자
                            let class_bookmark = word['bookmark_by_me'] ? "fa-bookmark" : "fa-bookmark-o"
                            let html_temp = `<tr id="${word['_id']}" >
                                                <td><a href="#">${word['word']}</a></td>
                                                <td>${word['meaning']}</td>
                                                <td><a class="level-item is-sparta" aria-label="bookmark" onclick="toggle_like('${word['_id']}', 'bookmark')">
                                                <span class="icon is-small"><i class="fa ${class_bookmark}" aria-hidden="true"></i></span></a></td>
                                                <td><button type="button" onclick="delete_word()">X</button></td>
                                            </tr>`

                            if (word['bookmark_by_me']) {
                                $("#tbody-box").append(html_temp)
                            }

                        }
                    }
                }
            })
        }


        function sign_out() {
                $.removeCookie('mytoken', {path: '/'});
                alert('로그아웃!')
                window.location.href = "/login"
        }

        function delete_word() {
            $.ajax({
                type: "POST",
                url: "/words/delete",
                data: {word_give: '{{ word }}'},
                success: function (response) {
                    alert(response["msg"])
                    window.location.reload()
                }
            });
        }


    </script>
</head>

<body>
<div class="wrap">
    <header>
        <div class="logo">
            <a href="/static/templates/index.html">코린이들의 단어장</a>
        </div>
        <div class="gnb_wrap">
            <ul class="gnb">
                <li><a href="/static/templates/index.html"><img src="/static/134213_home_house_building_main_icon.png" alt=""></a></li>
                <li><a onclick="bookmark()"><img src="/static/6637786_badge_mark_save_icon.png" alt=""></a></li>
                <li><a onclick="sign_out()"><img src="/static/8324223_ui_essential_app_avatar_profile_icon.png" alt=""></a></li>
            </ul>
        </div>
        <button id="login_bt"><a href="/static/templates/login.html">log-in</a></button>
    </header>
    <section>
        <div class="save_search_box">
            <div class="save">
                <span>< 사전 등록하기 ></span>
                <div class="sign" id="term_box">
                    <input type="text" placeholder="용어" id="word" style="font-family: 'Jua', sans-serif; font-size: 18px">
                </div>
                <div class="sign">
                    <input type="text" placeholder="의미" id="meaning" style="font-family: 'Jua', sans-serif; font-size: 18px">
                </div>
                <div class="save_bt">
                    <button onclick="post()" id="save_bt" style="font-family: 'Jua', sans-serif; font-size: 18px">저장하기</button>
                </div>
            </div>
            <div class="search">
                <input type="search" placeholder="용어를 입력하세요" id="search" style="font-family: 'Jua', sans-serif; font-size: 18px">
                <button onclick="find_word()" id="search_bt" style="font-family: 'Jua', sans-serif; font-size: 18px">검색</button>
            </div>
        </div><!-- save_search-box e -->
        <div class="save_in">
            <table class="table">
                <thead>
                <tr>
                    <th scope="col" style="width:30%">단어</th>
                    <th scope="col">의미</th>
                    <th scope="col" style="width:15%">북마크</th>
                                        <th scope="col" style="width:15%">삭제</th>

                </tr>
                </thead>
                <tbody id="tbody-box">


                    <tr id="word-word">
                        <td><a href="#">word</a></td>
                        <td>a single </td>
                        <td>a single </td>
                        <td><button type="button" onclick="delete_word()">X</button></td>
                    </tr>
                </tbody>
            </table>

        </div><!-- save_in e -->
    </section>
</div><!-- wrap e -->
</body>
</html>
